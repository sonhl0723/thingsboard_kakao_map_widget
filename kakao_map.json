{
  "alias": "kakao_map",
  "name": "Kakao Map",
  "image": null,
  "description": null,
  "descriptor": {
    "type": "latest",
    "sizeX": 7.5,
    "sizeY": 3,
    "resources": [
      {
        "url": "//dapi.kakao.com/v2/maps/sdk.js?appkey={apikey}&autoload=false"
      }
    ],
    "templateHtml": "<body>\r\n\t<div id=\"map\" style=\"width:100%;height:100%;\"></div>\r\n</body>\r\n",
    "templateCss": "#container {\n    overflow: auto;\n}\n\n.tbDatasource-container {\n    margin: 5px;\n    padding: 8px;\n}\n\n.tbDatasource-title {\n    font-size: 1.200rem;\n    font-weight: 500;\n    padding-bottom: 10px;\n}\n\n.tbDatasource-table {\n    width: 100%;\n    box-shadow: 0 0 10px #ccc;\n    border-collapse: collapse;\n    white-space: nowrap;\n    font-size: 1.000rem;\n    color: #757575;\n}\n\n.tbDatasource-table td {\n    position: relative;\n    border-top: 1px solid rgba(0, 0, 0, 0.12);\n    border-bottom: 1px solid rgba(0, 0, 0, 0.12);\n    padding: 0px 18px;\n    box-sizing: border-box;\n}\n\n.info-title {\n    display: block;\n    background: #50627F;\n    color: #fff;\n    text-align: center;\n    height: 24px;\n    line-height:22px;\n    border-radius:4px;\n    padding:0px 10px;\n}",
    "controllerScript": "var markerDict = {};\nvar dashboardInfo = {};\n\nfunction updateMarkerDict() {\n    var datasource = self.ctx.data;\n    \n    kakao.maps.load(function() {\n        if (datasource[0].data.length > 0) {\n            for (var idx = 0; idx < datasource.length; idx++) {\n                console.log(datasource[idx].datasource.name);\n                if(datasource[idx].datasource.aliasName == 'main') {\n                    continue;\n                }\n                \n                if (datasource[idx].datasource.name in markerDict) {\n                    markerDict[datasource[idx].datasource.name].push(datasource[idx].data[0][1]);\n                } else {\n                    markerDict[datasource[idx].datasource.name] = [datasource[idx].data[0][1]];\n                }\n                \n                if (markerDict[datasource[idx].datasource.name].length == 2) {\n                    makeMarker(datasource[idx].datasource.name);\n                    \n                    addMarkerEvent(datasource[idx].datasource.name);\n                }\n            }\n        }\n    })\n}\n\nfunction makeMarker(assetName) {\n    \n    kakao.maps.load(function() {\n        \n        var marker = new kakao.maps.Marker({\n            position: new kakao.maps.LatLng(markerDict[assetName][0], markerDict[assetName][1])\n        });\n        \n        markerDict[assetName].push(marker);\n        \n        markerDict[assetName][2].setMap(self.ctx.map);\n        \n        kakao.maps.event.addListener(markerDict[assetName][2], 'click', function() {\n            window.location.href = dashboardInfo[assetName];\n        });\n    });\n}\n\nfunction addMarkerEvent(assetName) {\n    kakao.maps.load(function() {\n        var content = '<span class=\"info-title\">'+assetName+'</span>';\n    \n        var titleOverlay = new kakao.maps.CustomOverlay({\n            position : new kakao.maps.LatLng(markerDict[assetName][0], markerDict[assetName][1]),\n            content : content,\n            yAnchor : 0.0005\n        })\n        \n        titleOverlay.setMap(self.ctx.map);\n    });\n}\n\nself.onInit = function() {\n    \n    var options;\n    var map;\n    var mapCenterCoordinate = [];\n    var mapContainer = $('#map', self.ctx.$container)[0];\n    var datasource = self.ctx.data;\n    \n    if (datasource.length > 0) {\n        idx = 0;\n        \n        while (idx < datasource.length) {\n            if (datasource[idx].datasource.aliasName == 'main') {\n                mapCenterCoordinate.push(datasource[idx].data[0][1]);\n            }\n            \n            if (mapCenterCoordinate.length == 2) {\n                break;\n            }\n            \n            idx++;\n        }\n    }\n    console.log(mapCenterCoordinate);\n    \n    if (self.ctx.actionsApi.actionDescriptorsBySourceId.headerButton != null) {\n        var actionInfo = self.ctx.actionsApi.actionDescriptorsBySourceId.headerButton;\n        var originLocation = window.location.origin;\n        \n        for(var idx = 0; idx < actionInfo.length; idx++) {\n            dashboardInfo[actionInfo[idx].displayName] = originLocation + '/dashboards/' + actionInfo[idx].targetDashboardId;\n        }\n    }\n    \n    kakao.maps.load(function() {\n        options = {\n            center: new kakao.maps.LatLng(mapCenterCoordinate[0], mapCenterCoordinate[1]),\n            level: 3\n        }\n\n        self.ctx.map = new kakao.maps.Map(mapContainer, options);\n    });\n\n    self.onResize();\n}\n\nself.onDataUpdated = function() {\n    kakao.maps.load(function() {\n        markerDict = {};\n        updateMarkerDict();\n    });\n}\n\nself.onResize = function() {\n    kakao.maps.load(function() {\n       self.ctx.map.relayout(); \n    });\n}\n\nself.onDestroy = function() {\n}\n",
    "settingsSchema": "{}",
    "dataKeySettingsSchema": "{}\n",
    "defaultConfig": "{\"datasources\":[{\"type\":\"function\",\"name\":\"function\",\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Random\",\"color\":\"#2196f3\",\"settings\":{},\"_hash\":0.15479322438769105,\"funcBody\":\"var value = prevValue + Math.random() * 100 - 50;\\nvar multiplier = Math.pow(10, 2 || 0);\\nvar value = Math.round(value * multiplier) / multiplier;\\nif (value < -1000) {\\n\\tvalue = -1000;\\n} else if (value > 1000) {\\n\\tvalue = 1000;\\n}\\nreturn value;\"}]}],\"timewindow\":{\"realtime\":{\"timewindowMs\":60000}},\"showTitle\":true,\"backgroundColor\":\"#fff\",\"color\":\"rgba(0, 0, 0, 0.87)\",\"padding\":\"8px\",\"settings\":{},\"title\":\"Kakao Map\"}"
  }
}